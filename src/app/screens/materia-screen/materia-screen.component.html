<section class="materias main-content-materias">
  <div class="container materia-container">
    <div class="row mb-4">
      <div class="col-12">
        <h2 class="materia-title">Gestión de Materias</h2>
        <p class="materia-subtitle">Administra las materias disponibles en el sistema escolar</p>
      </div>
    </div>

    <!-- Tabla de Materias -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h4>Lista de Materias</h4>
          </div>
          <div class="card-body">
            <!-- Buscador -->
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="input-group">
                  <span class="input-group-text" id="search-addon">
                    <i class="bi bi-search"></i>
                  </span>
                  <input 
                    type="text" 
                    class="form-control" 
                    placeholder="Buscar por NRC, Nombre, Sección, Programa o Profesor..."
                    [(ngModel)]="searchTerm"
                    (input)="aplicarBusqueda()"
                    aria-label="Buscar"
                    aria-describedby="search-addon"
                  >
                  <button 
                    class="btn btn-outline-secondary" 
                    type="button"
                    *ngIf="searchTerm"
                    (click)="searchTerm=''; aplicarBusqueda()">
                    <i class="bi bi-x-circle"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th scope="col" class="sortable" (click)="ordenar('nrc')">
                      NRC <i class="bi" [ngClass]="getSortIcon('nrc')"></i>
                    </th>
                    <th scope="col" class="sortable" (click)="ordenar('nombre')">
                      Nombre <i class="bi" [ngClass]="getSortIcon('nombre')"></i>
                    </th>
                    <th scope="col" class="sortable" (click)="ordenar('seccion')">
                      Sección <i class="bi" [ngClass]="getSortIcon('seccion')"></i>
                    </th>
                    <th>Días</th>
                    <th>Horario</th>
                    <th>Salón</th>
                    <th scope="col" class="sortable" (click)="ordenar('programa_educativo')">
                      Programa <i class="bi" [ngClass]="getSortIcon('programa_educativo')"></i>
                    </th>
                    <th scope="col" class="sortable" (click)="ordenar('profesor_nombre')">
                      Profesor <i class="bi" [ngClass]="getSortIcon('profesor_nombre')"></i>
                    </th>
                    <th>Créditos</th>
                    <th *ngIf="isAdmin">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let materia of paginatedData; let i=index">
                    <td>{{ materia.nrc }}</td>
                    <td>{{ materia.nombre }}</td>
                    <td>{{ materia.seccion }}</td>
                    <td>{{ materia.dias.join(', ') }}</td>
                    <td>{{ materia.hora_inicio }} - {{ materia.hora_fin }}</td>
                    <td>{{ materia.salon }}</td>
                    <td>{{ materia.programa_educativo }}</td>
                    <td>{{ materia.profesor_nombre }}</td>
                    <td>{{ materia.creditos }}</td>
                    <td *ngIf="isAdmin">
                      <button class="btn btn-sm btn-primary me-1" (click)="editarMateria(materia)" title="Editar">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" (click)="eliminarMateria(materia.id)" title="Eliminar">
                        <i class="bi bi-trash"></i>
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="lista_materias_filtradas.length === 0">
                    <td colspan="10" class="text-center">No hay materias registradas</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Paginación -->
            <div class="row mt-3 mb-3">
              <div class="col-12">
                <nav aria-label="Paginación de materias">
                  <ul class="pagination justify-content-center mb-0">
                    <li class="page-item" [class.disabled]="currentPage === 1">
                      <a class="page-link" (click)="goToPage(1)" tabindex="-1">
                        <i class="bi bi-chevron-double-left"></i>
                      </a>
                    </li>
                    <li class="page-item" [class.disabled]="currentPage === 1">
                      <a class="page-link" (click)="previousPage()" tabindex="-1">
                        <i class="bi bi-chevron-left"></i>
                      </a>
                    </li>
                    <li class="page-item" 
                        *ngFor="let page of getPageNumbers()"
                        [class.active]="currentPage === page">
                      <a class="page-link" (click)="goToPage(page)">{{page}}</a>
                    </li>
                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                      <a class="page-link" (click)="nextPage()">
                        <i class="bi bi-chevron-right"></i>
                      </a>
                    </li>
                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                      <a class="page-link" (click)="goToPage(totalPages)">
                        <i class="bi bi-chevron-double-right"></i>
                      </a>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
            <div class="row">
              <div class="col-12 text-center">
                <small class="text-muted">
                  Mostrando {{((currentPage - 1) * itemsPerPage) + 1}} - 
                  {{Math.min(currentPage * itemsPerPage, lista_materias_filtradas.length)}} 
                  de {{lista_materias_filtradas.length}} registros
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>